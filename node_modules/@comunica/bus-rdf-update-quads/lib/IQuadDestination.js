"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.validateHttpResponse = void 0;
const bus_http_1 = require("@comunica/bus-http");
const stringifyStream = require("stream-to-string");
/**
 * Check if the http response is valid, and throw an error if not.
 * @param url The original URL that was to be updated.
 * @param httpResponse The update response.
 */
async function validateHttpResponse(url, httpResponse) {
    // Check if update was successful
    if (httpResponse.status >= 400) {
        // Consume the body, to avoid process to hang
        let bodyString = 'empty response';
        if (httpResponse.body) {
            const responseStream = bus_http_1.ActorHttp.toNodeReadable(httpResponse.body);
            bodyString = await stringifyStream(responseStream);
        }
        throw new Error(`Could not update ${url} (HTTP status ${httpResponse.status}):\n${bodyString}`);
    }
    // Close response body, as we don't need it
    await httpResponse.body?.cancel();
}
exports.validateHttpResponse = validateHttpResponse;
//# sourceMappingURL=IQuadDestination.js.map